name: DebugBuild

on:
  push:
    branches: [ main ]
  pull_request:
    branches: [ main ]
  workflow_dispatch:

jobs:
  build:
    runs-on: windows-latest

    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Setup MSBuild
        uses: microsoft/setup-msbuild@v2

      # 1) DirectXTex を Release x64 でビルド（/MD, iterator=0 に合わせる）
      - name: Build DirectXTex (Release x64)
        working-directory: ${{ github.workspace }}\externals\DirectXTex
        run: msbuild DirectXTex_Desktop_2022_Win10.vcxproj /p:Platform=x64 /p:Configuration=Release /m

      # 2) Development フォルダに lib を配置（vcxproj は Development を参照しているため）
      - name: Make Development alias for DirectXTex (use Release lib)
        shell: pwsh
        working-directory: ${{ github.workspace }}\externals\DirectXTex\Bin\Desktop_2022_Win10\x64
        run: |
          New-Item -ItemType Directory -Force -Path Development | Out-Null
          Copy-Item -Force Release\DirectXTex.lib Development\DirectXTex.lib
          Get-ChildItem -Force Development

      # 3) ソリューションを Debug x64 でビルド
      - name: Build solution (Debug x64)
        run: msbuild "DirectXGame.sln" /p:Platform=x64 /p:Configuration=Debug /m
